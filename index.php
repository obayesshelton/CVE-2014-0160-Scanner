<?php

include_once "mycurl.php";

class HeartBleed
{
    CONST url = 'http://bleed-1161785939.us-east-1.elb.amazonaws.com/bleed/query?u=';

    // ADD AN ARRAY OF DOMAINS

    public $domains = array(
        'www.example.com',
        'www.example.com',
        'www.example.com',
        'www.example.com',
    );

    public $errors = array ();

    public $returnCode = null;

    public function call ($request = null, $post = null)
    {
        foreach($this->domains as $domain) {

            $fullUrl = self::url . "$domain";

            $c = new curl($fullUrl);

            if (isset($request)) {
                $c->setRequest($request);
            }

            if (isset($post)) {
                $json = json_encode($post);
                $c->setPost($json);
            }

            $c->createCurl();
            $resp = $c->getWebPage();
            $this->returnCode = $c->getHttpStatus();

            $this->checkVuln($resp, $domain);

        }
    }

    public function checkVuln($body, $domain) {

        $bodyObject = json_decode($body);

        if (isset($bodyObject->data) && $bodyObject->data !== '') {
            echo "            $domain IS VULNERABLE\n";
        } else {
            //echo "    $domain IS NOT VULNERABLE\n";
        }

    }
}

echo "Starting \n";

$heartbleed = new HeartBleed();
$heartbleed->call();

echo "Ended \n";
